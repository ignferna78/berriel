<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<link rel="shortcut icon" href="images/icon.jpg">
	<!-- Head Start -->
	<th:block th:include="componentes/_head.html"></th:block>
	<!-- Head End -->
</head>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
	<div class="container-fluid">
		<!-- "CASA BERRIEL" a la izquierda -->
		<a class="navbar-brand" href="/reservas/index">CASA BERRIEL</a>

		<!-- Botón de despliegue para dispositivos móviles -->
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
			aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<!-- Contenido del menú alineado a la derecha -->
		<div class="collapse navbar-collapse" id="navbarNav">
			<ul class="navbar-nav ms-auto">
				<!-- Dropdown para usuario autenticado -->
				<li th:if="${#httpServletRequest.remoteUser != null}" class="nav-item dropdown">
				    <a class="nav-link dropdown-toggle" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				        <span th:text="${#httpServletRequest.remoteUser}">Usuario</span>
				    </a>
				    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
				        <a sec:authorize="hasRole('ROLE_USER')" class="dropdown-item" th:href="@{/registro/detalle-usuario}">Perfil</a>
						<a sec:authorize="hasRole('ROLE_USER')" class="dropdown-item" href="/reservas/miReserva/">Mi reserva</a>
				        <a sec:authorize="hasRole('ROLE_ADMIN')" class="dropdown-item" href="/admin/lista">Panel de administración</a>
				        <div class="dropdown-divider"></div>
				        <a class="dropdown-item logout-button" href="/logout">Logout</a>
				    </div>
				</li>


				<li class="nav-item">
					<a class="nav-link" href="/reservas/index/#about" data-i18n="navbar.about">Sobre Nosotros</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/reservas/index/#services" data-i18n="services.title">Servicios</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/reservas/index/#gallery" data-i18n="navbar.gallery">Galería</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/reservas/index/#contact" data-i18n="navbar.contact">Contacto</a>
				</li>

				<!-- Opción de Login si el usuario no está autenticado -->
				<li th:if="${#httpServletRequest.remoteUser == null}" class="nav-item">
					<button class="btn btn-outline-primary" data-toggle="modal" data-target="#loginModal"
						data-i18n="navbar.login"></button>
				</li>

				<!-- Selector de idioma -->
				<li class="nav-item">
					<select id="languageSelector" class="form-control">
						<option value="es">Español</option>
						<option value="en">English</option>
					</select>
				</li>
			</ul>

		</div>
		<!-- Login Modal -->
		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true"
			th:classappend="${error} ? 'show' : ''">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="loginModalLabel">Iniciar Sesión</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form th:action="@{/autenticacionUsusario}" method="POST">
							<div id="error" class="alert alert-danger" style="display: none;"></div>

							<div class="form-group">
								<label for="email">Email</label>
								<input type="text" id="email" name="username" class="form-control"
									placeholder="Ingresa tu email">
							</div>
							<div class="form-group">
								<label for="password">Contraseña</label>
								<input type="password" id="password" name="password" class="form-control"
									placeholder="Ingresa tu contraseña">
							</div>
							<button type="submit" class="btn btn-primary btn-block">Iniciar Sesión</button>
							<span>Si no estás registrado, <a th:href="@{/registro/inicio}">Regístrate aquí</a></span>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
					</div>
				</div>
			</div>
		</div>


		<!-- Modal de confirmación de cierre de sesión -->
		<div class="modal fade" id="logoutConfirmModal" tabindex="-1" aria-labelledby="logoutConfirmModalLabel"
			aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="logoutConfirmModalLabel">Confirmación de Cierre de Sesión</h5>
					</div>
					<div class="modal-body">
						¿Estás seguro de que deseas cerrar sesión?
					</div>
					<div class="modal-footer">
						<!-- Este botón debería cerrar el modal automáticamente -->
						<button type="button" id="confirmLogoutBtn" class="btn btn-danger">Cerrar Sesión</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</nav>


<script>
	//Modal de Login

	document.addEventListener("DOMContentLoaded", function (e) {
		// Verifica si el parámetro 'logout' está en la URL
		e.preventDefault()
		const urlParams = new URLSearchParams(window.location.search);
		if (urlParams.get('error') === 'true') {
			$('#loginModal').modal('show'); // Muestra el modal de confirmación
			// Agrega y muestra el mensaje de error dinámicamente
			const errorMessageContainer = document.getElementById("error");
			errorMessageContainer.textContent = "Usuario o contraseña inválidos";
			errorMessageContainer.style.display = "block";

		}
	});
</script>